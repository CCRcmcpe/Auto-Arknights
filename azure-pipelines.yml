trigger:
  branches:
    include:
    - dev-2.0.0
  paths:
    exclude:
    - '**/*.md'

jobs:
- job: CI
  displayName: CI Build
  timeoutInMinutes: 10
  pool:
    vmImage: windows-latest
  steps:
  - checkout: self
    displayName: Checkout
  - task: UseDotNet@2
    displayName: Use DotNet
    inputs:
      packageType: 'sdk'
      useGlobalJson: true
      workingDirectory: 'Source/CLI'
  - task: DotNetCoreCLI@2
    displayName: Restore
    inputs:
      command: 'restore'
      projects: 'Source/**/*.csproj'
      feedsToUse: 'select'
  - task: DotNetCoreCLI@2
    displayName: Publish
    inputs:
      command: 'publish'
      publishWebProjects: false
      projects: 'Source/CLI/Auto Arknights CLI.csproj'
      arguments: '-c Publish -o $(Build.ArtifactStagingDirectory)/artifact/ --no-restore'
      zipAfterPublish: false
      workingDirectory: 'Source/CLI'
  - task: ArchiveFiles@2
    displayName: Archive Artifact
    inputs:
      rootFolderOrFile: $(Build.ArtifactStagingDirectory)/artifact
      includeRootFolder: false
      archiveType: 7z
      sevenZipCompression: ultra
      archiveFile: $(Build.ArtifactStagingDirectory)/Auto Arknights.7z
      replaceExistingArchive: true
  - task: PublishPipelineArtifact@1
    displayName: Publish Artifact
    inputs:
      targetPath: $(Build.ArtifactStagingDirectory)/Auto Arknights.7z
      artifactName: Auto Arknights CLI
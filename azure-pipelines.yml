trigger:
  branches:
    include:
    - dev-2.0.0
  paths:
    exclude:
    - '**/*.md'

jobs:
- job: CI
  displayName: CI Build
  timeoutInMinutes: 10
  pool:
    vmImage: windows-latest
  steps:
  - checkout: self
    displayName: Checkout
  - task: UseDotNet@2
    displayName: Use DotNet
    inputs:
      packageType: 'sdk'
      useGlobalJson: true
      workingDirectory: 'Source/CLI'
  - task: DotNetCoreCLI@2
    displayName: Restore
    inputs:
      command: 'restore'
      projects: 'Source/**/*.csproj'
      restoreArguments: '-r win-x64'
  - task: DotNetCoreCLI@2
    displayName: Publish
    inputs:
      command: 'publish'
      publishWebProjects: false
      projects: 'Source/CLI/Auto Arknights CLI.csproj'
      arguments: '-c Release -p:PublishProfile="Windows x64" --no-restore'
      zipAfterPublish: false
      workingDirectory: 'Source/CLI'
  - task: PublishPipelineArtifact@1
    displayName: Publish Artifact
    inputs:
      targetPath: Source/CLI/artifact
      artifactName: Auto Arknights CLI
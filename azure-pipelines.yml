trigger:
  branches:
    include:
    - '*'
  paths:
    exclude:
    - '**/*.md'

jobs:
- job: CI
  displayName: CI Build
  timeoutInMinutes: 10
  pool:
    vmImage: windows-latest
  steps:
  - checkout: self
    displayName: Checkout
  - task: UseDotNet@2
    displayName: Setup .NET
    inputs:
      packageType: 'sdk'
      useGlobalJson: true
      workingDirectory: 'Source/CLI'
  - task: PowerShell@2
    displayName: Build
    inputs:
      filePath: 'Build-Artifact.ps1'
      pwsh: true
      workingDirectory: 'Source/CLI'
  - task: ArchiveFiles@2
    displayName: Archive
    inputs:
      rootFolderOrFile: 'Source/CLI/artifact'
      includeRootFolder: false
      archiveType: '7z'
      sevenZipCompression: 'ultra'
      archiveFile: '$(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip'
  - task: PublishPipelineArtifact@1
    displayName: Publish
    inputs:
      targetPath: '$(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip'
      artifactName: Auto Arknights CLI